plugins {
    id 'java'
    id 'war'
}

group 'codesquad'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

java {
    sourceCompatibility = '17'
    targetCompatibility = '17'
}

ext {
    servletVersion = '6.1.0'
    junitVersion = '5.10.3'
    jstlVersion = '3.0.0'
    mockitoVersion = '5.12.0'
    assertJVersion = '3.26.3'
    logbackVersion = '1.5.6'
    mysqlVersion = '8.4.0'
    hikariVersion = '5.1.0'
    jacksonVersion = '2.17.2'
}

tasks.withType(JavaCompile).configureEach {
    options.encoding = 'UTF-8'
}

dependencies {
    // LogBack
    implementation("ch.qos.logback:logback-classic:${logbackVersion}")
    // MySQL Connector
    implementation("com.mysql:mysql-connector-j:${mysqlVersion}")
    // JSTL
    implementation("jakarta.servlet.jsp.jstl:jakarta.servlet.jsp.jstl-api:${jstlVersion}")
    implementation("org.glassfish.web:jakarta.servlet.jsp.jstl:${jstlVersion}")
    // HikariCP
    implementation("com.zaxxer:HikariCP:${hikariVersion}")
    // Jackson
    implementation("com.fasterxml.jackson.core:jackson-core:${jacksonVersion}")
    implementation("com.fasterxml.jackson.core:jackson-databind:${jacksonVersion}")


    // Junit5
    testImplementation platform("org.junit:junit-bom:${junitVersion}")
    testImplementation("org.junit.jupiter:junit-jupiter:${junitVersion}")
    // AssertJ
    testImplementation("org.assertj:assertj-core:${assertJVersion}")
    // Mockito
    testImplementation("org.mockito:mockito-core:${mockitoVersion}")
    testImplementation("org.mockito:mockito-junit-jupiter:${mockitoVersion}")

}

test {
    useJUnitPlatform()
}

tasks.register('dockerCompose', Exec) {
    dependsOn('build')
    commandLine 'docker', 'compose', 'up', '--build', '-d'
}